<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>DmFlow &#27231;&#22120;&#20154;API | DmFlow | Communeify </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="DmFlow &#27231;&#22120;&#20154;API | DmFlow | Communeify ">
    <meta name="description" content="API&#30340;&#29992;&#36884;&#26159;&#20197;&#31243;&#24335;&#30908;&#25628;&#23563;&#12289;&#20462;&#25913;&#21644;&#21034;&#38500;DmFlow&#20839;&#37096;&#36039;&#26009;&#12290;&#36879;&#36942;API&#65292;&#24744;&#21487;&#20197;&#20197;&#31243;&#24335;&#21270;&#30340;&#26041;&#24335;&#33287;DmFlow&#36039;&#26009;&#36914;&#34892;&#20114;&#21205;&#65292;&#23526;&#29694;&#28961;&#32299;&#25972;&#21512;&#21644;&#33258;&#21205;&#21270;&#30340;&#36039;&#26009;&#31649;&#29702;&#12290;&#25552;&#39640;&#25928;&#29575;&#12289;&#22686;&#24375;&#29983;&#29986;&#21147;&#65292;&#20805;&#20998;&#30332;&#25582;DmFlow&#20839;&#37096;&#36039;&#26009;&#30340;&#25033;&#29992;&#28507;&#21147;&#12290;">
    <meta name="generator" content="docfx 2.58.9.0">
    <meta name="google-site-verification" content="wackHW3mx9OzoWNdH73Ucfx-Tgn27NaVqlQ-dzKaBfw">
    
    <link rel="shortcut icon" href="../../../../images/favicon.ico">
    <meta property="docfx:appTitle" content="Communeify">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="機器人api">機器人API</h1>

<h2 id="authorization">Authorization</h2>
<p>每一個請求都需要攜帶Authorization.</p>
<p>組成為<method>&lt;URL_PATH&gt;&lt;QUERY_STRING&gt;&lt;REQUEST_BODY&gt;:&lt;CLIENT_ID&gt;:&lt;TIME_STAMP&gt;:&lt;RANDOM_VALUE&gt;<p>
<ul>
<li>METHOD:分為GET、POST、PATCH、PUT、DELETE(大寫)</li>
<li>QUERY_STRING:根據key從小排到大，若key相同則排序value。</li>
<li>REQUEST_BODY:如果METHOD為POST、PATCH、PUT時，可能會有REQUEST_DATA，如果沒有則不放文字。</li>
<li>CLIENT_ID:DMFlow提供的CLIENT_ID</li>
<li>TIMESTAMP:當前時間，用來判斷是否有過期。</li>
<li>RANDOM:用於判斷此操作有沒有重複做，一般用UUID即可。</li>
</ul>
<p>Postman pre script 參考。</p>
<pre><code>var uuid = require('uuid');
const secretKey = 'a60207f4d8abf6ee7bf14ecaa69fbb310310784abdae354fadd4939eda95e54c';
const clientId = '6d7ffe73-e922-4011-9057-606fc42966d8';

const isJsonContent = pm.request.headers.get('Content-Type') === 'application/json';

let requestData = pm.request.method.toUpperCase() + pm.request.url.getPath();

const queryString = pm.request.url.query;
if (queryString) {
    const queryParams = queryString.toObject();
    const sortedParams = Object.entries(queryParams)
        .sort(([key1, value1], [key2, value2]) =&gt; key1.localeCompare(key2));
    const queryStringBuilder = [];
    sortedParams.forEach(([paramName, paramValues]) =&gt; {
        if (!Array.isArray(paramValues)) {
            paramValues = [paramValues];
        }
        paramValues.sort();
        paramValues.forEach((value) =&gt; {
            queryStringBuilder.push(`${paramName}=${value}`);
        });
    });

    requestData += queryStringBuilder.join('&amp;')
}
if (isJsonContent) {
    requestData += request.data;
}

const timestamp = Math.floor(Date.now() / 1000);
const randomValue = uuid.v4();
requestData += (':' + clientId + ':' + timestamp + ':' + randomValue);
const signature = CryptoJS.HmacSHA256(requestData, secretKey).toString(CryptoJS.enc.Hex);
var map = { 'signature': 'sha256=' + signature, 'clientId': clientId, 'timestamp': timestamp, 'random': randomValue };
var words = CryptoJS.enc.Utf8.parse(JSON.stringify(map));
var base64 = CryptoJS.enc.Base64.stringify(words);
pm.environment.set('auth', 'Bearer ' + base64);
</code></pre>
<h2 id="機器人詳情">機器人詳情</h2>
<p>擷取機器人內的名稱、描述以及時區。</p>
<p>GET /_api/v1/bot/info</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
  &quot;rc&quot;: 0,
  &quot;data&quot;: {
    &quot;id&quot;: &quot;12345678&quot;,
    &quot;name&quot;: &quot;bot&quot;,
    &quot;description&quot;: &quot;範例&quot;,
    &quot;locale&quot;: &quot;zh_TW&quot;
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.id</td>
<td>機器人id</td>
</tr>
<tr>
<td>data.name</td>
<td>機器人名稱</td>
</tr>
<tr>
<td>data.description</td>
<td>機器人描述</td>
</tr>
<tr>
<td>data.locale</td>
<td>機器人語系</td>
</tr>
</tbody>
</table>
<h2 id="機器人對話">機器人對話</h2>
<p>機器人的圖形對話流程，知識庫和問答對的問答。</p>
<h3 id="流程對話">流程對話</h3>
<p>POST /_api/v1/bot/chat</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
    &quot;branch&quot;: &quot;dev&quot;,
    &quot;platform&quot;: &quot;messenger&quot;,
    &quot;userId&quot;: &quot;8840402706055126&quot;,
    &quot;type&quot;: &quot;text&quot;,
    &quot;payload&quot;: {
        &quot;query&quot;: &quot;天氣&quot;,
        &quot;type&quot;: &quot;text&quot;
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>branch</td>
<td>x</td>
<td>ENUM</td>
<td>prod、dev，若為null則為prod</td>
</tr>
<tr>
<td>platform</td>
<td>v</td>
<td>STRING</td>
<td>分為line、messenger、api、telegram、telegram</td>
</tr>
<tr>
<td>userId</td>
<td>v</td>
<td>STRING</td>
<td>由呼叫方自行定義，可使用uuid</td>
</tr>
<tr>
<td>type</td>
<td>v</td>
<td>ENUM</td>
<td>event、text、attachment</td>
</tr>
<tr>
<td>scene</td>
<td>x</td>
<td>STRING</td>
<td>此為填寫場景名稱，預設為Main，當填寫後會根據情境節點中的&quot;回到主情境&quot;對應。詳情請參考&quot;機器人流程&quot;。</td>
</tr>
<tr>
<td>payload</td>
<td>v</td>
<td>OBJECT</td>
<td>傳給DmFlow的訊息</td>
</tr>
</tbody>
</table>
<h4 id="payload">payload</h4>
<p>type = text</p>
<p>文字訊息</p>
<pre><code>&quot;payload&quot;: {
  &quot;query&quot;: &quot;xxx&quot;,
  &quot;type&quot;: &quot;text&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>v</td>
<td>STRING</td>
<td>詢問的問題</td>
</tr>
<tr>
<td>type</td>
<td>v</td>
<td>ENUM</td>
<td>text，目前僅提供text</td>
</tr>
</tbody>
</table>
<p>type = attachment</p>
<p>檔案訊息</p>
<pre><code>&quot;payload&quot;: {
  &quot;url&quot;: &quot;xxx&quot;,
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;name&quot;: &quot;text.txt&quot;
  &quot;size&quot;: 10240,
  &quot;type&quot;: &quot;file&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>x/v</td>
<td>STRING</td>
<td>與id二選一，為檔案連結</td>
</tr>
<tr>
<td>id</td>
<td>x/v</td>
<td>STRING</td>
<td>與url二選一，為檔案id</td>
</tr>
<tr>
<td>name</td>
<td>v</td>
<td>STRING</td>
<td>檔案名稱</td>
</tr>
<tr>
<td>size</td>
<td>v</td>
<td>NUMBER</td>
<td>檔案容量</td>
</tr>
</tbody>
</table>
<p>圖片訊息</p>
<pre><code>&quot;payload&quot;: {
  &quot;url&quot;: &quot;xxx&quot;,
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;previewImageUrl&quot;: &quot;xxx&quot;
  &quot;type&quot;: &quot;image&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>x/v</td>
<td>STRING</td>
<td>與id二選一，為圖片連結</td>
</tr>
<tr>
<td>id</td>
<td>x/v</td>
<td>STRING</td>
<td>與url二選一，為圖片id</td>
</tr>
<tr>
<td>previewImageUrl</td>
<td>x</td>
<td>STRING</td>
<td>圖片縮圖網址</td>
</tr>
</tbody>
</table>
<p>影片訊息</p>
<pre><code>&quot;payload&quot;: {
  &quot;url&quot;: &quot;xxx&quot;,
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;previewImageUrl&quot;: &quot;xxx&quot;
  &quot;type&quot;: &quot;video&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>x/v</td>
<td>STRING</td>
<td>與id二選一，為影片連結</td>
</tr>
<tr>
<td>id</td>
<td>x/v</td>
<td>STRING</td>
<td>與url二選一，為影片id</td>
</tr>
<tr>
<td>previewImageUrl</td>
<td>x</td>
<td>STRING</td>
<td>影片縮圖網址</td>
</tr>
</tbody>
</table>
<p>語音訊息</p>
<pre><code>&quot;payload&quot;: {
  &quot;url&quot;: &quot;xxx&quot;,
  &quot;id&quot;: &quot;uuid&quot;,
  &quot;duration&quot;: 60
  &quot;type&quot;: &quot;audio&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>x/v</td>
<td>STRING</td>
<td>與id二選一，為語音連結</td>
</tr>
<tr>
<td>id</td>
<td>x/v</td>
<td>STRING</td>
<td>與url二選一，為語音id</td>
</tr>
<tr>
<td>duration</td>
<td>x</td>
<td>NUMBER</td>
<td>語音持續時間(秒)</td>
</tr>
</tbody>
</table>
<p>type = event</p>
<p>打斷事件</p>
<p>會將當前情境中斷，並從指定情境開始，當指定情境結束後會回來當前情境繼續完成工作。</p>
<pre><code>&quot;payload&quot;: {
  &quot;context&quot;: &quot;xxx&quot;,
  &quot;type&quot;: &quot;sleep&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>PAYLOAD_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>context</td>
<td>v</td>
<td>STRING</td>
<td>打斷到指定情境</td>
</tr>
</tbody>
</table>
<p>忽略事件</p>
<p>當呼叫此事件，將不會做任何事情。</p>
<pre><code>&quot;payload&quot;: {
  &quot;type&quot;: &quot;ignore&quot;
}
</code></pre>
<p>開始事件</p>
<p>當呼叫此事件，將會清空當前session狀態，重新開始。</p>
<pre><code>&quot;payload&quot;: {
  &quot;type&quot;: &quot;start&quot;
}
</code></pre>
<p>結束事件</p>
<p>當呼叫此事件，同&quot;開始事件&quot;，但是不會再問開始節點的問話，並保持睡眠狀態，需搭配&quot;喚醒模式&quot;使用。</p>
<pre><code>&quot;payload&quot;: {
  &quot;type&quot;: &quot;end&quot;
}
</code></pre>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;replies&quot;: [
            &quot;{\&quot;text\&quot;:\&quot;今天天氣舒服\&quot;}&quot;
        ],
        &quot;msg_type&quot;: &quot;JSON&quot;,
        &quot;version_id&quot;: &quot;274504579784423095&quot;,
        &quot;fallback&quot;: false,
        &quot;status&quot;: &quot;WAIT&quot;
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>NUMBER</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>STRING</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.replies</td>
<td>ARRAY</td>
<td>回答陣列</td>
</tr>
<tr>
<td>data.msg_type</td>
<td>ENUM</td>
<td>回答型態TEXT、IMAGE、AUDIO、VIDEO、EVENT、JSON、FILE，目前僅提供JSON、TEXT</td>
</tr>
<tr>
<td>data.version_id</td>
<td>STRING</td>
<td>當前機器人版本</td>
</tr>
<tr>
<td>data.fallback</td>
<td>BOOLEAN</td>
<td>是否命中失誤</td>
</tr>
<tr>
<td>data.status</td>
<td>ENUM</td>
<td>WAIT、LISTEN</td>
</tr>
</tbody>
</table>
<p>data.replies</p>
<p>當REQUEST的platform使用了對話模板，RESPONSE中的data.replies將會把該平台的JSON做輸出。</p>
<p>假設REQUEST的platform = api 回應如下。</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;replies&quot;: [
            &quot;今天天氣舒服&quot;
        ],
        &quot;msg_type&quot;: &quot;TEXT&quot;,
        &quot;version_id&quot;: &quot;274504579784423095&quot;,
        &quot;fallback&quot;: false,
        &quot;status&quot;: &quot;WAIT&quot;
    }
}
</code></pre>
<p>data.status</p>
<ul>
<li>WAIT 等待用戶回話。</li>
<li>LISTEN 只做聆聽不做事，需搭配開始節點的&quot;喚醒模式&quot;使用。</li>
</ul>
<h3 id="問答對話">問答對話</h3>
<p>POST /_api/v1/bot/faqs/{faqId}</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
    &quot;text&quot;: &quot;工程師&quot;,
    &quot;userId&quot;: &quot;12345&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>text</td>
<td>v</td>
<td>STRING</td>
<td>詢問問題</td>
</tr>
<tr>
<td>userId</td>
<td>v</td>
<td>STRING</td>
<td>由呼叫方自行定義，可使用uuid</td>
</tr>
<tr>
<td>bestThreshold</td>
<td>x</td>
<td>FLOAT</td>
<td>0.1~1 最佳選擇答案</td>
</tr>
<tr>
<td>suggThreshold</td>
<td>x</td>
<td>FLOAT</td>
<td>0.1~1 建議選擇答案</td>
</tr>
<tr>
<td>timezone</td>
<td>x</td>
<td>NUMBER</td>
<td>預設800-&gt;UTC+08:00</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;answer&quot;: &quot;[\&quot;job_interview\&quot;]&quot;,
        &quot;question&quot;: &quot;面試JAVA工程師&quot;,
        &quot;type&quot;: &quot;REDIRECT&quot;,
        &quot;fallback&quot;: false,
        &quot;suggQuestions&quot;: [
            {
                &quot;question&quot;: &quot;面試Node.js工程師&quot;,
                &quot;answer&quot;: &quot;[\&quot;interview_nodejs\&quot;]&quot;,
                &quot;type&quot;: &quot;REDIRECT&quot;
            },
            {
                &quot;question&quot;: &quot;介紹Node.js工程師&quot;,
                &quot;answer&quot;: &quot;[\&quot;describe_nodejs\&quot;]&quot;,
                &quot;type&quot;: &quot;REDIRECT&quot;
            },
            {
                &quot;question&quot;: &quot;介紹Angular工程師&quot;,
                &quot;answer&quot;: &quot;[\&quot;describe_angular\&quot;]&quot;,
                &quot;type&quot;: &quot;REDIRECT&quot;
            }
        ]
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE_PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>NUMBER</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>STRING</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.answer</td>
<td>STRING</td>
<td>type = 'REDITECT'=&gt;'[&quot;targetContext&quot;]', type=TEXT=&gt;'answer'</td>
</tr>
<tr>
<td>data.type</td>
<td>ENUM</td>
<td>REDIRECT、TEXT</td>
</tr>
<tr>
<td>data.fallback</td>
<td>BOOLEAN</td>
<td>是否未命中</td>
</tr>
<tr>
<td>data.suggQuestions</td>
<td>ARRAY</td>
<td>當其他答案高於建議選擇答案比率，將會顯示其他答案</td>
</tr>
</tbody>
</table>
<p>data.type</p>
<ul>
<li>REDIRECT =&gt; JSONARRAT STRING 用於轉向其他情境節點</li>
<li>TEXT =&gt; 純文字回答</li>
</ul>
<p>data.suggQuestions</p>
<table>
<thead>
<tr>
<th>PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>question</td>
<td>STRING</td>
<td>文檔問題</td>
</tr>
<tr>
<td>answer</td>
<td>STRING</td>
<td>文檔答案</td>
</tr>
<tr>
<td>type</td>
<td>ENUM</td>
<td>REDIRECT、TEXT</td>
</tr>
</tbody>
</table>
<h3 id="表格問答對話">表格問答對話</h3>
<p>POST /_api/v1/bot/tableqas/{tableqaId}</p>
<p>!此回答為範例練習，手機內容不符合真實!</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
    &quot;text&quot;: &quot;價格在6000元到七千元且品牌為蘋果的手機&quot;,
    &quot;userId&quot;: &quot;5610b60sa183abb1a49de8b8955c1625&quot;,
    &quot;sessionId&quot;: &quot;sd6e303ce8e89576dd79afb5d1ab8fc3b&quot;,
    &quot;subjectSize&quot;: 10
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>text</td>
<td>x/v</td>
<td>STRING</td>
<td>詢問問題，event=next時可不填寫</td>
</tr>
<tr>
<td>userId</td>
<td>v</td>
<td>STRING</td>
<td>由呼叫方自行定義，可使用uuid</td>
</tr>
<tr>
<td>sessionId</td>
<td>v</td>
<td>STRING</td>
<td>相同sessionId才能進行上下文對答</td>
</tr>
<tr>
<td>subjectSize</td>
<td>x</td>
<td>NUMBER</td>
<td>預設為10，1-10 顯示數量</td>
</tr>
<tr>
<td>timezone</td>
<td>x</td>
<td>NUMBER</td>
<td>預設800-&gt;UTC+08:00</td>
</tr>
<tr>
<td>reset</td>
<td>x</td>
<td>BOOLEAN</td>
<td>預設FALSE，為TRUE時會消除session所有資料</td>
</tr>
<tr>
<td>event</td>
<td>x/v</td>
<td>ENUM</td>
<td>reset(用於消除當前儲存的過濾條件)、next(下一頁，當有page時需要使用此參數)</td>
</tr>
<tr>
<td>page</td>
<td>x/v</td>
<td>OBJECT</td>
<td>當要跳轉下一頁的時候為必填，且event必須是next</td>
</tr>
<tr>
<td>filterMap</td>
<td>x/v</td>
<td>OBJECT</td>
<td>過濾條件，event=next時若需要過濾條件則為必填</td>
</tr>
</tbody>
</table>
<p>page</p>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>index</td>
<td>v</td>
<td>NUMBER</td>
<td>頁數索引</td>
</tr>
<tr>
<td>size</td>
<td>v</td>
<td>NUMBER</td>
<td>同 subjectSize</td>
</tr>
</tbody>
</table>
<p>filterMap</p>
<p>此為&quot;價格在6000元到七千元且品牌為蘋果的手機&quot;的詢問</p>
<p>分析:</p>
<ul>
<li>價格大於6000且小於7000</li>
<li>品牌等於蘋果</li>
</ul>
<pre><code>{
  &quot;filterMap&quot;: {
    &quot;price&quot;: [
      {
        &quot;key&quot;: &quot;price&quot;,
        &quot;op&quot;: &quot;gte&quot;,
        &quot;value&quot;: &quot;6000&quot;
      },
      {
        &quot;key&quot;: &quot;price&quot;,
        &quot;op&quot;: &quot;lte&quot;,
        &quot;value&quot;: &quot;7000&quot;
      }
    ],
    &quot;brand&quot;: [
      {
        &quot;op&quot;: &quot;eq&quot;,
        &quot;value&quot;: &quot;蘋果&quot;,
        &quot;key&quot;: &quot;brand&quot;
      }
    ]
  }
}
</code></pre>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;filterMap&quot;: {
            &quot;price&quot;: [
                {
                    &quot;op&quot;: &quot;gte&quot;,
                    &quot;value&quot;: &quot;6000.0&quot;,
                    &quot;key&quot;: &quot;price&quot;
                },
                {
                    &quot;op&quot;: &quot;lte&quot;,
                    &quot;value&quot;: &quot;7000.0&quot;,
                    &quot;key&quot;: &quot;price&quot;
                }
            ],
            &quot;brand&quot;: [
                {
                    &quot;op&quot;: &quot;eq&quot;,
                    &quot;value&quot;: &quot;蘋果&quot;,
                    &quot;key&quot;: &quot;brand&quot;
                }
            ]
        },
        &quot;answer&quot;: &quot;&quot;,
        &quot;subjects&quot;: [
            {
                &quot;name&quot;: &quot;iphone12&quot;,
                &quot;attributes&quot;: [
                    {
                        &quot;name&quot;: &quot;charge&quot;,
                        &quot;value&quot;: &quot;支持&quot;,
                        &quot;render&quot;: false
                    },
                    {
                        &quot;name&quot;: &quot;price&quot;,
                        &quot;value&quot;: &quot;iphone12的價格是6900元&quot;,
                        &quot;render&quot;: false
                    },
                    {
                        &quot;name&quot;: &quot;charging&quot;,
                        &quot;value&quot;: &quot;支持&quot;,
                        &quot;render&quot;: false
                    },
                    {
                        &quot;name&quot;: &quot;battery&quot;,
                        &quot;value&quot;: &quot;3500&quot;,
                        &quot;render&quot;: false
                    },
                    {
                        &quot;name&quot;: &quot;brand&quot;,
                        &quot;value&quot;: &quot;蘋果&quot;,
                        &quot;render&quot;: false
                    },
                    {
                        &quot;name&quot;: &quot;ram&quot;,
                        &quot;value&quot;: &quot;128&quot;,
                        &quot;render&quot;: false
                    }
                ]
            }
        ],
        &quot;page&quot;: {
            &quot;total&quot;: 1,
            &quot;size&quot;: 10,
            &quot;index&quot;: 0
        },
        &quot;fallback&quot;: false
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.filterMap</td>
<td>分析語法過濾條件</td>
</tr>
<tr>
<td>data.answer</td>
<td>當查找不到或未命中時產生的話語</td>
</tr>
<tr>
<td>data.subjects</td>
<td>實體</td>
</tr>
<tr>
<td>data.page</td>
<td>當前頁面</td>
</tr>
<tr>
<td>data.fallback</td>
<td>未命中</td>
</tr>
</tbody>
</table>
<p>data.subjects</p>
<table>
<thead>
<tr>
<th>PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>實體名稱</td>
</tr>
<tr>
<td>attributes</td>
<td>實體屬性</td>
</tr>
</tbody>
</table>
<p>attributes</p>
<table>
<thead>
<tr>
<th>PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>欄位鍵</td>
</tr>
<tr>
<td>value</td>
<td>欄位值</td>
</tr>
</tbody>
</table>
<h2 id="領域詳情">領域詳情</h2>
<p>根據機器人開啟的領域做過濾。</p>
<h3 id="領域">領域</h3>
<p>GET /_api/v1/bot/domains?types=faqEnum&amp;types=tableqaEnum</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>參數</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>types</td>
<td>faqEnum(問答對), tableqaEnum(表格問答), intentEnum(意圖)</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;domains&quot;: [
            {
                &quot;name&quot;: &quot;hire&quot;,
                &quot;description&quot;: &quot;面試&quot;,
                &quot;id&quot;: &quot;267950411136516195&quot;,
                &quot;type&quot;: &quot;faqEnum&quot;
            },
            {
                &quot;name&quot;: &quot;phone&quot;,
                &quot;description&quot;: &quot;手機介紹&quot;,
                &quot;id&quot;: &quot;271530283370373185&quot;,
                &quot;type&quot;: &quot;tableqaEnum&quot;
            },
            {
                &quot;name&quot;: &quot;car&quot;,
                &quot;description&quot;: &quot;汽車介紹&quot;,
                &quot;id&quot;: &quot;263431310541176907&quot;,
                &quot;type&quot;: &quot;tableqaEnum&quot;
            }
        ]
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.domains[0].name</td>
<td>領域名稱</td>
</tr>
<tr>
<td>data.domains[0].description</td>
<td>領域描述</td>
</tr>
<tr>
<td>data.domains[0].id</td>
<td>領域id</td>
</tr>
<tr>
<td>data.domains[0].type</td>
<td>領域型態</td>
</tr>
</tbody>
</table>
<h3 id="問答對列表">問答對列表</h3>
<p>GET /_api/v1/bot/faqs</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;faqs&quot;: [
            {
                &quot;name&quot;: &quot;hire&quot;,
                &quot;description&quot;: &quot;面試&quot;,
                &quot;id&quot;: &quot;267950411136516195&quot;
            }
        ]
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.faqs[0].name</td>
<td>領域名稱</td>
</tr>
<tr>
<td>data.faqs[0].description</td>
<td>領域描述</td>
</tr>
<tr>
<td>data.faqs[0].id</td>
<td>領域id</td>
</tr>
</tbody>
</table>
<h3 id="知識庫列表">知識庫列表</h3>
<p>GET /_api/v1/bot/tableqas</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;tableqas&quot;: [
            {
                &quot;name&quot;: &quot;car&quot;,
                &quot;description&quot;: &quot;汽車介紹&quot;,
                &quot;id&quot;: &quot;263431310541176907&quot;
            },
            {
                &quot;name&quot;: &quot;phone&quot;,
                &quot;description&quot;: &quot;手機介紹&quot;,
                &quot;id&quot;: &quot;271530283370373185&quot;
            }
        ]
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.tableqas[0].name</td>
<td>領域名稱</td>
</tr>
<tr>
<td>data.tableqas[0].description</td>
<td>領域描述</td>
</tr>
<tr>
<td>data.tableqas[0].id</td>
<td>領域id</td>
</tr>
</tbody>
</table>
<h2 id="使用者詳情">使用者詳情</h2>
<h3 id="獲取使用者們">獲取使用者們</h3>
<p>POST /_api/v1/bot/users</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
  &quot;platform&quot;: &quot;api&quot;,
  &quot;index&quot;: 0,
  &quot;size&quot;: 10
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform</td>
<td>v</td>
<td>分為line、messenger、api、telegram、telegram</td>
</tr>
<tr>
<td>index</td>
<td>v</td>
<td>索引，以0開始</td>
</tr>
<tr>
<td>size</td>
<td>v</td>
<td>索取的數量</td>
</tr>
<tr>
<td>systemFields</td>
<td>x</td>
<td>系統使用者屬性</td>
</tr>
<tr>
<td>customFields</td>
<td>x</td>
<td>客製使用者屬性</td>
</tr>
<tr>
<td>includes</td>
<td>x</td>
<td>包含標籤</td>
</tr>
<tr>
<td>afterUpdatedTime</td>
<td>x</td>
<td>更新在某一時間之後</td>
</tr>
</tbody>
</table>
<p>systemFields</p>
<p>範例：</p>
<pre><code>{
  &quot;platform&quot;: &quot;api&quot;,
  &quot;index&quot;: 0,
  &quot;size&quot;: 10,
  &quot;systemFields&quot; : {
      &quot;username&quot;: &quot;xxx&quot;
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>systemFields</td>
<td>OBJECT</td>
<td>用於填寫預設的系統屬性</td>
</tr>
<tr>
<td>systemFields.username</td>
<td>STRING</td>
<td>系統使用者名稱</td>
</tr>
</tbody>
</table>
<p>customFields</p>
<p>範例：</p>
<pre><code>{
  &quot;platform&quot;: &quot;api&quot;,
  &quot;index&quot;: 0,
  &quot;size&quot;: 10,
  &quot;customFields&quot; : [
      {
	      &quot;key&quot;: &quot;username&quot;,
	      &quot;op&quot;: &quot;eq&quot;,
	      &quot;value&quot;: &quot;小王&quot;
	  }
  ]
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>型態</th>
<th>限制數量</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>customFields</td>
<td>ARRAY</td>
<td>10</td>
<td>用於自定義屬性</td>
</tr>
<tr>
<td>customFields[0].key</td>
<td>STRING</td>
<td></td>
<td>屬性鍵</td>
</tr>
<tr>
<td>customFields[0].op</td>
<td>STRING</td>
<td></td>
<td>屬性比較gte(大於等於), lte(小於等於), eq(相等), not_eq(不等於)</td>
</tr>
<tr>
<td>customFields[0].value</td>
<td>STRING</td>
<td></td>
<td>屬性值，時間要轉換成Seconds，數字要滿足數字型態</td>
</tr>
</tbody>
</table>
<p>includes</p>
<p>範例：</p>
<pre><code>{
  &quot;platform&quot;: &quot;api&quot;,
  &quot;index&quot;: 0,
  &quot;size&quot;: 10,
  &quot;includes&quot; : [
      &quot;254870170810449954&quot;
  ]
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>型態</th>
<th>限制數量</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>includes</td>
<td>ARRAY</td>
<td>10</td>
<td>用於自定義標籤id</td>
</tr>
</tbody>
</table>
<p>afterUpdatedTime</p>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>afterUpdatedTime</td>
<td>Long</td>
<td>表示過濾這個時間點後的使用者(milliSeconds)</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
  &quot;rc&quot;: 0,
  &quot;data&quot;: {
    &quot;page&quot;: {
      &quot;total&quot;: 2,
      &quot;size&quot;: 10,
      &quot;index&quot;: 0
    },
    &quot;users&quot;: [
      {
        &quot;updatedTime&quot;: 1665674749,
        &quot;createdTime&quot;: 1662800401,
        &quot;hasImage&quot;: false,
        &quot;id&quot;: &quot;388634744657944592&quot;,
        &quot;fields&quot;: [
          {
            &quot;constraintType&quot;: &quot;datetimeEnum&quot;,
            &quot;id&quot;: &quot;283615327961481304&quot;,
            &quot;value&quot;: &quot;1641312000&quot;,
            &quot;key&quot;: &quot;birthday&quot;,
            &quot;desc&quot;: &quot;生日&quot;
          },
          {
            &quot;constraintType&quot;: &quot;stringEnum&quot;,
            &quot;id&quot;: &quot;478075408797933588&quot;,
            &quot;value&quot;: &quot;小王&quot;,
            &quot;key&quot;: &quot;username&quot;,
            &quot;desc&quot;: &quot;使用者名稱&quot;
          }
        ],
        &quot;userId&quot;: &quot;5610b61ca183abb1a48de8b8955c1627&quot;,
        &quot;platform&quot;: &quot;@api&quot;,
        &quot;enabled&quot;: false,
        &quot;username&quot;: &quot;小王&quot;,
        &quot;tags&quot;: [
          {
            &quot;id&quot;: &quot;254870170810449954&quot;
          },
          {
            &quot;id&quot;: &quot;256770248043135038&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.page.total</td>
<td>回傳過濾過的使用者數量</td>
</tr>
<tr>
<td>data.page.index</td>
<td>當前頁數索引</td>
</tr>
<tr>
<td>data.page.size</td>
<td>當前頁面數量</td>
</tr>
<tr>
<td>data.users[0].image</td>
<td>用戶圖片</td>
</tr>
<tr>
<td>data.users[0].updateTime</td>
<td>更新日期(秒)</td>
</tr>
<tr>
<td>data.users[0].createdTime</td>
<td>創建日期(秒)</td>
</tr>
<tr>
<td>data.users[0].hasImage</td>
<td>是否有圖片，platform為line跟messenger有</td>
</tr>
<tr>
<td>data.users[0].id</td>
<td>使用者DmFlow id</td>
</tr>
<tr>
<td>data.users[0].userId</td>
<td>使用者的platform id</td>
</tr>
<tr>
<td>data.users[0].platform</td>
<td>分為line、messenger、api、telegram</td>
</tr>
<tr>
<td>data.users[0].enabled</td>
<td>是否啟用，如果line被blocked時將會關閉</td>
</tr>
<tr>
<td>data.users[0].username</td>
<td>使用者名稱</td>
</tr>
<tr>
<td>data.users[0]tags</td>
<td>使用者標籤</td>
</tr>
<tr>
<td>data.users[0].tags[0].id</td>
<td>標籤id</td>
</tr>
<tr>
<td>data.users[0].fields</td>
<td>使用者屬性</td>
</tr>
<tr>
<td>data.users[0].fields[0].constraintType</td>
<td>datetimeEnum(日期), stringEnum(字串), numEnum(數字), passwdEnum(密碼)</td>
</tr>
<tr>
<td>data.users[0].fields[0].id</td>
<td>記憶欄位id</td>
</tr>
<tr>
<td>data.users[0].fields[0].key</td>
<td>記憶欄位鍵</td>
</tr>
<tr>
<td>data.users[0].fields[0].value</td>
<td>記憶欄位使用者值</td>
</tr>
<tr>
<td>data.users[0].fields[0].desc</td>
<td>記憶欄位描述</td>
</tr>
</tbody>
</table>
<h3 id="獲取使用者">獲取使用者</h3>
<p>第一種userId是客戶產生的ID，第二種查詢是以DmFlow分發的ID做查詢</p>
<h4 id="第一種">第一種</h4>
<p>GET /_api/v1/bot/users/{userId}?platform=messenger</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>參數</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform</td>
<td>分為line、messenger、api、telegram</td>
</tr>
</tbody>
</table>
<h4 id="第二種">第二種</h4>
<p>GET /_api/v1/bot/users/_id/{id}</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
  &quot;rc&quot;: 0,
  &quot;data&quot;: {
    &quot;image&quot;: &quot;{{IMAGE_PROVIDER}}/f15a4a8a28de8519e5502fbf393ed3fd&quot;,
    &quot;updatedTime&quot;: 1665674749,
    &quot;createdTime&quot;: 1662800401,
    &quot;hasImage&quot;: true,
    &quot;id&quot;: &quot;488634744657944593&quot;,
    &quot;fields&quot;: [
      {
        &quot;constraintType&quot;: &quot;datetimeEnum&quot;,
        &quot;id&quot;: &quot;283615327961481304&quot;,
        &quot;value&quot;: &quot;1641312000&quot;,
        &quot;key&quot;: &quot;birthday&quot;,
        &quot;desc&quot;: &quot;生日&quot;
      },
      {
        &quot;constraintType&quot;: &quot;stringEnum&quot;,
        &quot;id&quot;: &quot;478075408797933588&quot;,
        &quot;value&quot;: &quot;小王&quot;,
        &quot;key&quot;: &quot;username&quot;,
        &quot;desc&quot;: &quot;使用者名稱&quot;
      }
    ],
    &quot;userId&quot;: &quot;5610b60ca183abb1a48de8b8955c1627&quot;,
    &quot;platform&quot;: &quot;@fbmessenger&quot;,
    &quot;enabled&quot;: true,
    &quot;username&quot;: &quot;小王&quot;,
    &quot;tags&quot;: [
      {
        &quot;lastModifiedTime&quot;: 1664382904,
        &quot;count&quot;: &quot;2&quot;,
        &quot;name&quot;: &quot;tag1&quot;,
        &quot;id&quot;: &quot;254870170810449954&quot;,
        &quot;desc&quot;: &quot;標籤1&quot;
      },
      {
        &quot;lastModifiedTime&quot;: 1664382875,
        &quot;count&quot;: &quot;4&quot;,
        &quot;name&quot;: &quot;tag2&quot;,
        &quot;id&quot;: &quot;256770248043135038&quot;,
        &quot;desc&quot;: &quot;標籤2&quot;
      }
    ]
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.image</td>
<td>用戶圖片</td>
</tr>
<tr>
<td>data.updateTime</td>
<td>更新日期(秒)</td>
</tr>
<tr>
<td>data.createdTime</td>
<td>創建日期(秒)</td>
</tr>
<tr>
<td>data.hasImage</td>
<td>是否有圖片，platform為line跟messenger有</td>
</tr>
<tr>
<td>data.id</td>
<td>使用者DmFlow id</td>
</tr>
<tr>
<td>data.userId</td>
<td>使用者的platform id</td>
</tr>
<tr>
<td>data.platform</td>
<td>分為line、messenger、api、telegram</td>
</tr>
<tr>
<td>data.enabled</td>
<td>是否啟用，如果line被blocked時將會關閉</td>
</tr>
<tr>
<td>data.username</td>
<td>使用者名稱</td>
</tr>
<tr>
<td>data.tags</td>
<td>使用者標籤</td>
</tr>
<tr>
<td>data.tags[0].lastModifiedTime</td>
<td>標籤最後修改時間(秒)</td>
</tr>
<tr>
<td>data.tags[0].count</td>
<td>標籤獲得了幾次</td>
</tr>
<tr>
<td>data.tags[0].name</td>
<td>標籤鍵</td>
</tr>
<tr>
<td>data.tags[0].id</td>
<td>標籤id</td>
</tr>
<tr>
<td>data.tags[0].desc</td>
<td>標籤描述</td>
</tr>
<tr>
<td>data.fields</td>
<td>使用者屬性</td>
</tr>
<tr>
<td>data.fields[0].constraintType</td>
<td>datetimeEnum(日期), stringEnum(字串), numEnum(數字), passwdEnum(密碼)</td>
</tr>
<tr>
<td>data.fields[0].id</td>
<td>記憶欄位id</td>
</tr>
<tr>
<td>data.fields[0].key</td>
<td>記憶欄位鍵</td>
</tr>
<tr>
<td>data.fields[0].value</td>
<td>記憶欄位使用者值</td>
</tr>
<tr>
<td>data.fields[0].desc</td>
<td>記憶欄位描述</td>
</tr>
</tbody>
</table>
<h3 id="用戶對話-第一種">用戶對話-第一種</h3>
<p>GET /_api/v1/bot/users/{userId}/conversations</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>參數</th>
<th>必填</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform</td>
<td>v</td>
<td>分為line、messenger、api、telegram</td>
</tr>
<tr>
<td>size</td>
<td>v</td>
<td>數量</td>
</tr>
<tr>
<td>page</td>
<td>v</td>
<td>索引從0開始</td>
</tr>
<tr>
<td>branch</td>
<td>x</td>
<td>預設prod，分為dev、prod</td>
</tr>
<tr>
<td>from_type</td>
<td>x</td>
<td>可以過濾該訊息來自哪裡，此為分頁查找完畢才過濾，數量會低於size，分為API, USER, BOT, THIRD_PARTY</td>
</tr>
<tr>
<td>msg_type</td>
<td>x</td>
<td>可以過濾該訊息類型，此為分頁查找完畢才過濾，數量會低於size，分為text, image, audio, video, json, event, none, html, files, file, redirect</td>
</tr>
</tbody>
</table>
<h3 id="用戶對話-第二種">用戶對話-第二種</h3>
<p>GET /_api/v1/bot/users/_id/{id}/conversations</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>參數</th>
<th>必填</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>v</td>
<td>數量</td>
</tr>
<tr>
<td>page</td>
<td>v</td>
<td>索引從0開始</td>
</tr>
<tr>
<td>from_type</td>
<td>x</td>
<td>可以過濾該訊息來自哪裡，此為分頁查找完畢才過濾，數量會低於size，分為API, USER, BOT, THIRD_PARTY</td>
</tr>
<tr>
<td>msg_type</td>
<td>x</td>
<td>可以過濾該訊息類型，此為分頁查找完畢才過濾，數量會低於size，分為text, image, audio, video, json, event, none, html, files, file, redirect</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.messages</td>
<td>為陣列</td>
</tr>
<tr>
<td>data.messages[0].from</td>
<td>from_type</td>
</tr>
<tr>
<td>data.messages[0].type</td>
<td>msg_type</td>
</tr>
<tr>
<td>data.messages[0].content</td>
<td>訊息內容</td>
</tr>
<tr>
<td>data.messages[0].createTime</td>
<td>訊息創建時間</td>
</tr>
<tr>
<td>data.total</td>
<td>所有訊息總共有多少</td>
</tr>
<tr>
<td>data.cur_page</td>
<td>當前索引</td>
</tr>
<tr>
<td>data.total_page</td>
<td>所有索引共多少</td>
</tr>
<tr>
<td>data.size</td>
<td>當前顯示訊息數量</td>
</tr>
</tbody>
</table>
<h3 id="修改使用者">修改使用者</h3>
<p>PATCH /_api/v1/bot/users/{userId}</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
  &quot;sysFields&quot;: {
    &quot;username&quot;: &quot;小王&quot;
  },
  &quot;platform&quot;: &quot;api&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>參數</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>platform</td>
<td>v</td>
<td>ENUM</td>
<td>分為line、messenger、api、telegram</td>
</tr>
<tr>
<td>sysFields</td>
<td>x</td>
<td>OBJECT</td>
<td>系統屬性</td>
</tr>
<tr>
<td>customFields</td>
<td>x</td>
<td>ARRAY</td>
<td>客製屬性</td>
</tr>
<tr>
<td>tags</td>
<td>x</td>
<td>ARRAY</td>
<td>標籤選擇</td>
</tr>
</tbody>
</table>
<p>sysFields</p>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>sysFields</td>
<td>v</td>
<td>OBJECT</td>
<td>用於填寫預設的系統屬性</td>
</tr>
<tr>
<td>sysFields.username</td>
<td>x</td>
<td>STRING</td>
<td>系統使用者名稱</td>
</tr>
<tr>
<td>sysFields.enabled</td>
<td>x</td>
<td>BOOLEAN</td>
<td>系統使用者是否啟用</td>
</tr>
</tbody>
</table>
<p>範例:</p>
<pre><code>{
  &quot;sysFields&quot;: {
    &quot;username&quot;: &quot;小王&quot;
  },
  &quot;platform&quot;: &quot;api&quot;
}
</code></pre>
<p>customFields</p>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>型態</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>customFields</td>
<td>OBJECT</td>
<td>用於填寫客製的屬性</td>
</tr>
<tr>
<td>customFields.xxx</td>
<td>STRING</td>
<td>客製欄位的id，可以在&quot;記憶模板查詢&quot;查找</td>
</tr>
</tbody>
</table>
<p>範例:</p>
<pre><code>{
  &quot;customFields&quot;: {
    &quot;478075408797933588&quot;: &quot;小王&quot;
  },
  &quot;platform&quot;: &quot;api&quot;
}
</code></pre>
<p>tags</p>
<p>將會取代該使用者所有的tags</p>
<pre><code>{
  &quot;tags&quot;: [&quot;254870170810449954&quot;],
  &quot;platform&quot;: &quot;api&quot;
}
</code></pre>
<p>RESPONSE JSON</p>
<pre><code>{
    &quot;rc&quot;: 0,
    &quot;data&quot;: {
        &quot;success&quot;: true
    }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.success</td>
<td>為true為成功修改</td>
</tr>
</tbody>
</table>
<h2 id="模板詳情">模板詳情</h2>
<p>記憶模板內標籤以及使用者存取資料欄位。</p>
<h3 id="標籤查詢">標籤查詢</h3>
<p>GET /_api/v1/bot/tags</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
  &quot;rc&quot;: 0,
  &quot;data&quot;: {
    &quot;tags&quot;: [
      {
        &quot;name&quot;: &quot;tag1&quot;,
        &quot;description&quot;: &quot;標籤1&quot;,
        &quot;id&quot;: &quot;254870170810449954&quot;
      },
      {
        &quot;name&quot;: &quot;tag2&quot;,
        &quot;description&quot;: &quot;標籤2&quot;,
        &quot;id&quot;: &quot;256770248043135038&quot;
      }
    ]
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.tags[0].name</td>
<td>標籤名稱</td>
</tr>
<tr>
<td>data.tags[0].description</td>
<td>標籤描述</td>
</tr>
<tr>
<td>data.tags[0].id</td>
<td>標籤id</td>
</tr>
</tbody>
</table>
<h3 id="使用者記憶模板查詢">使用者記憶模板查詢</h3>
<p>GET /_api/v1/bot/memories</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>RESPONSE JSON</p>
<pre><code>{
  &quot;rc&quot;: 0,
  &quot;data&quot;: {
    &quot;userFields&quot;: [
      {
        &quot;description&quot;: &quot;使用者名稱&quot;,
        &quot;id&quot;: &quot;478075408797933588&quot;,
        &quot;type&quot;: &quot;stringEnum&quot;,
        &quot;key&quot;: &quot;username&quot;
      },
      {
        &quot;description&quot;: &quot;生日&quot;,
        &quot;id&quot;: &quot;283615327961481304&quot;,
        &quot;type&quot;: &quot;datetimeEnum&quot;,
        &quot;key&quot;: &quot;birthday&quot;
      },
      {
        &quot;description&quot;: &quot;密碼&quot;,
        &quot;id&quot;: &quot;477723514581819413&quot;,
        &quot;type&quot;: &quot;passwdEnum&quot;,
        &quot;key&quot;: &quot;passwd&quot;
      }
    ]
  }
}
</code></pre>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
<tr>
<td>data.userFields[0].id</td>
<td>記憶欄位id</td>
</tr>
<tr>
<td>data.userFields[0].description</td>
<td>記憶欄位描述</td>
</tr>
<tr>
<td>data.userFields[0].key</td>
<td>記憶欄位鍵</td>
</tr>
<tr>
<td>data.userFields[0].type</td>
<td>記憶欄位type(stringEnum, numEnum, datetimeEnum, passwdEnum)</td>
</tr>
</tbody>
</table>
<h2 id="事件">事件</h2>
<h3 id="使用者註冊事件">使用者註冊事件</h3>
<p>POST /_api/v1/bot/event/register</p>
<table>
<thead>
<tr>
<th>HEADER KEY</th>
<th>HEADER VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td>{{auth}}</td>
</tr>
</tbody>
</table>
<p>REQUEST JSON</p>
<pre><code>{
  &quot;broad_hash_id&quot;: &quot;xxxxxxxxx&quot;,
  &quot;platform&quot;: &quot;line&quot;,
  &quot;userId&quot;: &quot;Uxxxxxxxxx&quot;
}
</code></pre>
<table>
<thead>
<tr>
<th>REQUEST_PATH</th>
<th>必填</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>broad_hash_id</td>
<td>v</td>
<td>broad提供的id</td>
</tr>
<tr>
<td>platform</td>
<td>v</td>
<td>分為line、messenger、api、telegram</td>
</tr>
<tr>
<td>userId</td>
<td>v</td>
<td>client_userId</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>RESPONSE PATH</th>
<th>說明</th>
</tr>
</thead>
<tbody>
<tr>
<td>rc</td>
<td>回應碼，0=&gt;回應成功，不等於0為錯誤</td>
</tr>
<tr>
<td>error</td>
<td>當回應碼不為0的時候產生的錯誤訊息</td>
</tr>
</tbody>
</table>
<h1 id="最後更新時間">最後更新時間</h1>
<p>2023/06/20</p>
<ul>
<li>刪除所有API需要appId的參數，一律以系統內部設置為主。</li>
</ul>
<p>2023/05/23</p>
<ul>
<li>新增&quot;使用者註冊事件&quot;</li>
</ul>
</method></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>Copyright © <script>document.write(new Date().getFullYear());</script> Communeify</span>
            
          </div>
        </div>
      </footer>
    </div>
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
    <style>
        #cookie-notice {padding: 0.5rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8); z-index: 1000;}
        #cookie-notice a {display: inline-block; cursor: pointer; margin-left: 0.5rem;}
        @media (max-width: 767px) {
            #cookie-notice span {display: block; padding-top: 3px; margin-bottom: 1rem;}
            #cookie-notice a {position: relative; bottom: 4px;}
        }
    </style>
    <div id="cookie-notice"><span id="cookie_notice">We would like to use third party cookies and scripts to improve the functionality of this website.</span><a id="cookie-notice-accept" class="btn btn-primary btn-sm">Approve</a><a href="/tw/privacy.html" class="btn btn-primary btn-sm" id="cookie-privacy">Privacy Policy</a></div>
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-VDL6P3EXCQ"></script>
    <script>
        function addAnalytics() {
            window.dataLayer = window.dataLayer || [];
            function gtag() {
              dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'G-VDL6P3EXCQ');
        }
        var defaultLanguage = navigator.language;
    	translateLang(defaultLanguage);
    	function translateLang(language) {
    	  var url = window.location.pathname;
    	  var selectLang = '';
          try{
              var lang = url.split('/')[1];
              if (lang === 'en') {
                selectLang = 'en';
              } else if (lang === 'tw') {
                selectLang = 'tw';
              } else if (lang === 'cn') {
                selectLang = 'tw';
              }
          }catch(e) {
          }
    	  if(selectLang === '') {
            if (language === 'zh-TW' || language === 'zh-CN') {
    		    selectLang = 'tw';
            } else {
    		    selectLang = 'en';
    	    }
    	  }
    	  var cookieTW = '我們希望使用第三方的Cookie和腳本來提升本網站的功能性。';
    	  var cookieEN = 'We would like to use third party cookies and scripts to improve the functionality of this website.';
    	  var approveTW = '允許';
    	  var approveEN = 'Approve';
    	  var privacyTW = '隱私權政策';
    	  var privacyEN = 'Privacy Policy';
    	  var cookieNoticeElement = document.getElementById('cookie_notice');
          cookieNoticeElement.textContent = selectLang === 'en' ? cookieEN : cookieTW;
    	  var cookieNoticeAcceptElement = document.getElementById('cookie-notice-accept');
          cookieNoticeAcceptElement.textContent = selectLang === 'en' ? approveEN : approveTW;
    	  var cookiePrivacyElement = document.getElementById('cookie-privacy');
          cookiePrivacyElement.textContent = selectLang === 'en' ? privacyEN : privacyTW;
    	  cookiePrivacyElement.href = selectLang === 'en' ? '/en/privacy.html' : '/tw/privacy.html';
    	}
    
        function createCookie(name,value,days) {
            var expires = "";
            if (days) {
                var date = new Date();
                date.setTime(date.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + value + expires + "; path=/";
        }
        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }
        function eraseCookie(name) {
            createCookie(name,"",-1);
        }
    
        if(readCookie('cookie-notice-dismissed')=='true') {
            addAnalytics();
        } else {
            document.getElementById('cookie-notice').style.display = 'block';
        }
        document.getElementById('cookie-notice-accept').addEventListener("click",function() {
            createCookie('cookie-notice-dismissed','true',31);
            document.getElementById('cookie-notice').style.display = 'none';
            location.reload();
        });
    
    </script>  </body>
</html>
